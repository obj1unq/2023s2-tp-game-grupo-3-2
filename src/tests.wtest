import zombies.*
import elementos.*
import personajePrincipal.*
import randomizer.*
import wollok.game.*
import direcciones.*

describe "test del juego" {	
	
		const zombie = new ZombieNormal (position=game.at(1,2))
	    const enemigoFinal = new ZombieGrande(position=game.at(17,2))
	    const pocion = new Pocion(position=game.at(1,2))
	    const moneda = new Moneda(position=game.at(1,2),valorMoneda =1)
	    const proyectil = new Fuego(position=game.at(1,2), imagenDisparo="fireball1.png",danio = 2 )
	    
        test "movimientos del mago" {
        	mago.position(game.at(1,2))
            mago.mover(derecha)
            assert.equals(game.at(2,2),mago.position())
            mago.mover(izquierda)
            assert.equals(game.at(1,2),mago.position())
            mago.mover(arriba)
            assert.equals(game.at(1,3),mago.position())
            mago.mover(abajo)
            assert.equals(game.at(1,2),mago.position())
        }
        test "verificar si el mago sale del tablero" {
        	mago.position(game.at(18,18))
        	mago.mover(arriba)
        	assert.equals(game.at(18,18),mago.position())
        	mago.mover(derecha)
        	assert.equals(game.at(18,18),mago.position())
        	
        	mago.position(game.at(0,0))
        	mago.mover(abajo)
        	assert.equals(game.at(0,0),mago.position())
        	mago.mover(izquierda)
        	assert.equals(game.at(0,0),mago.position())
        }
        test "mago toma pocion de vida " {
        	mago.vida(5)
        	assert.throwsException({pocion.contacto(mago)})
        	assert.equals(10, mago.vida() )
        }
        test "mago valida salud maxima" {
        	assert.throwsException({pocion.contacto(mago)})
        	assert.equals(10, mago.vida() )
        }
        /* Este test no sirve xq el mago apesar que guardas monedas el sabe cuanto hay es el
         * monedero.
        test "mago agarra la moneda" {
        	assert.equals(0, mago.monedas() )
        	assert.throwsException({moneda.contacto(mago)})
        	assert.equals(1, mago.monedas() )
        }*/
        test "mago agarra arma" {
        	armaFuego.position(game.at(1,3))
        	mago.position(game.at(1,3))
        	assert.equals(libre, mago.llevando() )
        	
        	mago.agarrar()
        	assert.equals(llevada, mago.llevando() )
        }
        test "mago valida agarrar arma" {
        	assert.throwsException({mago.agarrar()})
        	assert.equals(libre, mago.llevando() )
        }
        test "mago verifica si lleva el arma" {
        	armaFuego.position(game.at(1,2))
        	mago.agarrar()
        	mago.mover(derecha)
        	assert.equals(armaFuego.position(), mago.position() )
        }
        test "mago es perseguido por zombie " {
        	mago.mover(izquierda)
        	zombie.mover()
        	assert.equals(game.at(0,2),zombie.position())
        	mago.mover(arriba)
        	zombie.mover()
        	assert.equals(game.at(0,3),zombie.position())
        	mago.mover(abajo)
        	zombie.mover()
        	assert.equals(game.at(0,2),zombie.position())
        	mago.mover(derecha)
        	zombie.mover()
        	assert.equals(game.at(1,2),zombie.position())
        	
        }
        test "mago es perseguido por enemigo final" {
        	mago.mover(arriba)
        	enemigoFinal.mover()
        	assert.equals(game.at(17,3),enemigoFinal.position())
        	mago.mover(abajo)
        	enemigoFinal.mover()
        	assert.equals(game.at(17,2),enemigoFinal.position())
        } 
        test "mago pierde vida " {
        	mago.perderVida(zombie)
        	assert.equals(9, mago.vida() )
        } 
        test "mago es herido por zombie " {
        	zombie.atacar()
        	assert.equals(9, mago.vida() )
        }
        test "mago es herido con un proyetil" {
        	assert.throwsException({mago.impactoDeBala(proyectil)})
        	assert.equals(8, mago.vida() )
        }
        test "enemigo normal es herido con proyectil" {
        	assert.throwsException({zombie.impactoDeBala(proyectil)})
        	assert.equals(8, zombie.vida() )
        }
        test "enemigo final es herido con proyectil" {
        	assert.throwsException({enemigoFinal.impactoDeBala(proyectil)})
        	assert.equals(18, enemigoFinal.vida() )
        }
        test "enemigo normal muere y deja una moneda" {
        	assert.throwsException({zombie.morir()})
        	assert.notThat(game.hasVisual(zombie))
        	assert.equals(monedero.monedas() , game.getObjectsIn(game.at(1,2)) )
        }
        
        
}
